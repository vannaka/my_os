/*********************************************************************
*
*   MODULE:
*       interrupts.h
*
*   DESCRIPTION:
*       Interrupt definitions
*
*********************************************************************/

#ifndef _KERNEL_INTERRUPTS_ARCH_H
#define _KERNEL_INTERRUPTS_ARCH_H

/*--------------------------------------------------------------------
                               INCLUDES
--------------------------------------------------------------------*/

#include <stdint.h>

/*--------------------------------------------------------------------
                          LITERAL CONSTANTS
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                                TYPES
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                           MEMORY CONSTANTS
--------------------------------------------------------------------*/

#ifdef __cplusplus
extern "C" {
#endif

/*--------------------------------------------------------------------
                              VARIABLES
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                                MACROS
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                              PROCEDURES
--------------------------------------------------------------------*/

/*********************************************************************
*
*   PROCEDURE NAME:
*       interrupts_enable
*
*   DESCRIPTION:
*       Enable interrupts
*
*********************************************************************/
static inline void interrupts_enable
    (
    void
    )
    {
    __asm__ ( "sti" );
    
    } /* interrupts_enable() */


/*********************************************************************
*
*   PROCEDURE NAME:
*       interrupts_enable
*
*   DESCRIPTION:
*       Disable interrupts and save flags
*
*********************************************************************/
static inline uint32_t interrupts_disable
    (
    void
    )
    {
    uint32_t            flags;

    __asm__ volatile ( 
        "pushf\n\t"
        "cli\n\t"
        "pop %0"
        :
        "=r"(flags)
        :
        :
        "memory" );

    return flags;
    
    } /* interrupts_disable() */


/*********************************************************************
*
*   PROCEDURE NAME:
*       interrupts_restore
*
*   DESCRIPTION:
*       Restore interrupts and flags
*
*********************************************************************/
static inline void interrupts_restore
    (
    uint32_t            flags
    )
    {
    __asm__ ( 
        "push %0\n\t"
        "popf" 
        : 
        : 
        "rm"(flags) 
        : 
        "memory","cc" 
        );

    } /* interrupts_restore() */


#ifdef __cplusplus
}
#endif
#endif /* _KERNEL_INTERRUPTS_ARCH_H */