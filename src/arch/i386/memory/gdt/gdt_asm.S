/*********************************************************************
*
*   MODULE:
*       gdt_asm.S
*
*   DESCRIPTION:
*       GDT assembly routines
*
*********************************************************************/

/*--------------------------------------------------------------------
                               INCLUDES
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                          LITERAL CONSTANTS
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                                TYPES
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                                MACROS
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                           MEMORY CONSTANTS
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                              VARIABLES
--------------------------------------------------------------------*/

/*--------------------------------------------------------------------
                              PROCEDURES
--------------------------------------------------------------------*/

/*********************************************************************
*
*   PROCEDURE NAME:
*       do_install_gdt
*
*   DESCRIPTION:
*       Install the gdt
*
*   void do_install_gdt
*      (
*      struct desc_ptr *
*      )
*********************************************************************/
.global do_install_gdt
.type do_install_gdt, @function
do_install_gdt:
   movl 4(%esp), %eax
   lgdt (%eax)

    // Reload CS register containing code selector:
   jmp   $0x08,$.reload_CS // 0x08 points at the new code selector
.reload_CS:
   // Reload data segment registers:
   mov $0x10, %ax
   mov %ax, %ds
   mov %ax, %es
   mov %ax, %fs
   mov %ax, %gs
   mov %ax, %ss
   ret